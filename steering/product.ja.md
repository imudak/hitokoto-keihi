# プロダクト要件定義 - ひとこと経費記録PWA

## 1. プロダクト概要

### 1.1 プロダクト名
**ひとこと経費記録** (hitokoto-keihi)

### 1.2 コンセプト
フリーランス・個人事業主向けに、経費記録の心理的ハードルを極限まで下げたPWA。

### 1.3 解決する課題

**ターゲットユーザー:**
- フリーランス・個人事業主
- 副業で確定申告が必要な会社員
- 経費記録を面倒に感じている全ての人

**現状の課題:**
- 会計アプリは機能が多すぎて使い始めるまでのハードルが高い
- レシート撮影・仕訳入力が面倒で後回しにする
- 簡単なメモアプリだと月次集計ができない
- 記録漏れで確定申告時に困る

**本アプリの解決策:**
- 音声/テキストで「コンビニ 450円 昼食」のような一言入力
- PWAで即起動、オフラインでも記録可能
- カテゴリ自動推定でストレスゼロ
- 月次サマリーで支出を可視化

## 2. ユーザーストーリー

### US-1: 経費を素早く記録したい
```
As a フリーランス
I want 一言で経費を記録できる
So that 移動中・外出先でも即座に記録できる
```

**受け入れ基準:**
- テキスト入力で「場所 金額 メモ」を入力すると記録される
- 音声入力でも同様に記録できる
- 記録完了まで3秒以内

### US-2: カテゴリ分けを自動化したい
```
As a 個人事業主
I want カテゴリを自動推定してほしい
So that 手動分類の手間を省きたい
```

**受け入れ基準:**
- 「コンビニ」→ 食費
- 「電車」「タクシー」→ 交通費
- 「Amazon」→ 事務用品費
- 推定カテゴリは編集可能

### US-3: 月次で支出を把握したい
```
As a フリーランス
I want 月別・カテゴリ別の支出を見たい
So that 経費の使い方を振り返りたい
```

**受け入れ基準:**
- 月別合計金額を表示
- カテゴリ別円グラフを表示
- 前月比較を表示

### US-4: 会計ソフトに取り込みたい
```
As a 個人事業主
I want CSVでエクスポートしたい
So that freee/MFクラウドに取り込める
```

**受け入れ基準:**
- CSV形式（日付,カテゴリ,金額,メモ,場所）
- PDFレポート生成（月次サマリー付き）

### US-5: オフラインでも使いたい
```
As a 移動が多いフリーランス
I want オフライン環境でも記録したい
So that 電波がない場所でも使える
```

**受け入れ基準:**
- Service Worker導入
- LocalStorageで永続化
- オフライン時も全機能利用可能

## 3. 機能要件

### 3.1 MVP機能（Phase 1）

#### F-1.1 経費記録（一言入力）
- **入力形式:** 「場所 金額 メモ」（順不同可）
- **パース例:**
  - 「コンビニ 450円 昼食」→ 場所:コンビニ, 金額:450, メモ:昼食
  - 「タクシー 1200円」→ 場所:タクシー, 金額:1200
  - 「Amazon 3500円 マウス購入」→ 場所:Amazon, 金額:3500, メモ:マウス購入
- **音声入力:** Web Speech API使用
- **自動推定:**
  - カテゴリ推定（後述）
  - 記録日時（現在日時をデフォルト、編集可能）

#### F-1.2 カテゴリ自動推定
| キーワード | カテゴリ |
|------------|----------|
| コンビニ, スーパー, カフェ, 昼食, 夕食, ランチ | 食費 |
| 電車, バス, タクシー, ガソリン, 駐車場 | 交通費 |
| Amazon, ヨドバシ, マウス, キーボード, 文房具 | 事務用品費 |
| 携帯, スマホ, WiFi, インターネット, サーバー | 通信費 |
| 書籍, Kindle, Udemy, セミナー | 研修費 |
| その他（上記以外） | その他 |

#### F-1.3 記録一覧表示
- 日付降順でリスト表示
- 各行: 日付, カテゴリ, 金額, 場所, メモ
- 編集ボタン（モーダル表示）
- 削除ボタン（確認ダイアログ）

#### F-1.4 記録の編集・削除
- 編集: 全フィールド変更可能
- 削除: 確認ダイアログ表示後に削除
- LocalStorageから即座に反映

### 3.2 MVP機能（Phase 2）

#### F-2.1 月次サマリー表示
- 月選択（ドロップダウン）
- 合計金額表示
- カテゴリ別円グラフ（Chart.js使用）
- 前月比較（増減％表示）

#### F-2.2 CSVエクスポート
- フォーマット: `日付,カテゴリ,金額,場所,メモ`
- 文字コード: UTF-8 BOM付き（Excel対応）
- ファイル名: `経費記録_YYYY-MM.csv`

#### F-2.3 PDFエクスポート
- 月次サマリーレポート
- カテゴリ別集計表
- 記録一覧（日付順）
- jsPDF使用

### 3.3 MVP機能（Phase 3: PWA化）

#### F-3.1 Service Worker
- キャッシュ戦略: Cache First
- オフライン時も全機能利用可能

#### F-3.2 manifest.json
- アプリ名: ひとこと経費記録
- アイコン: 512x512, 192x192
- テーマカラー: #4F46E5 (indigo-600)
- display: standalone

#### F-3.3 ホーム画面追加
- iOS Safari対応
- Android Chrome対応
- インストールプロンプト表示

## 4. 非機能要件

### 4.1 パフォーマンス
- 初回ロード: 3秒以内（3G環境）
- 一言入力→記録完了: 1秒以内
- 一覧表示（1000件）: 1秒以内

### 4.2 データ
- LocalStorageで5000件まで保存可能
- データサイズ: 1件あたり約200バイト → 5000件で約1MB
- バックアップ: CSV/PDFエクスポートで手動バックアップ

### 4.3 プライバシー・セキュリティ
- **サーバー送信なし:** 全データは端末内LocalStorageに保存
- **個人情報:** 不要（メールアドレス・ログイン不要）
- **暗号化:** 現時点では非対応（将来検討）

### 4.4 対応ブラウザ
- Chrome 90+
- Safari 14+ (iOS含む)
- Firefox 88+
- Edge 90+

### 4.5 アクセシビリティ
- キーボード操作対応
- 音声入力対応（Web Speech API）
- スクリーンリーダー対応（ARIA属性）

## 5. UI/UX設計

### 5.1 画面構成

#### 5.1.1 ホーム画面
```
+----------------------------------+
| ひとこと経費記録                  |
+----------------------------------+
| [マイク] コンビニ 450円 昼食     |
|         [記録する]                |
+----------------------------------+
| 今月の合計: ¥45,300              |
+----------------------------------+
| 記録一覧 | 月次サマリー | 設定    |
+----------------------------------+
| 2026-02-15  食費  ¥450           |
| コンビニ - 昼食       [編集][削除]|
+----------------------------------+
| 2026-02-14  交通費  ¥1,200       |
| タクシー              [編集][削除]|
+----------------------------------+
```

#### 5.1.2 月次サマリー画面
```
+----------------------------------+
| 月次サマリー                      |
| [2026年2月 ▼]                    |
+----------------------------------+
| 合計: ¥45,300  (前月比 +12%)     |
+----------------------------------+
|   [円グラフ]                      |
|   食費 40%                        |
|   交通費 30%                      |
|   通信費 20%                      |
|   その他 10%                      |
+----------------------------------+
| カテゴリ別詳細                    |
| 食費:      ¥18,120 (40%)         |
| 交通費:    ¥13,590 (30%)         |
| 通信費:    ¥9,060 (20%)          |
| その他:    ¥4,530 (10%)          |
+----------------------------------+
| [CSVエクスポート] [PDFエクスポート]|
+----------------------------------+
```

### 5.2 カラースキーム
- **プライマリ:** indigo-600 (#4F46E5)
- **セカンダリ:** gray-600 (#4B5563)
- **成功:** green-500 (#10B981)
- **警告:** yellow-500 (#F59E0B)
- **エラー:** red-500 (#EF4444)

### 5.3 タイポグラフィ
- **フォント:** システムフォント（-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto）
- **サイズ:** text-sm, text-base, text-lg, text-xl, text-2xl（Tailwind基準）

## 6. 技術スタック

### 6.1 フロントエンド
- **フレームワーク:** React 18
- **言語:** TypeScript 5
- **ビルドツール:** Vite 5
- **スタイリング:** Tailwind CSS 3
- **グラフ:** Chart.js 4
- **PDF生成:** jsPDF 2

### 6.2 ストレージ
- **ローカル:** LocalStorage（シンプル・オフライン対応）
- **バックアップ:** CSV/PDFエクスポート

### 6.3 デプロイ
- **ホスティング:** Cloudflare Pages（無料、CDN、自動ビルド）
- **ドメイン:** 初期はCloudflare提供サブドメイン

## 7. データモデル

### 7.1 Expense型（経費記録）

```typescript
interface Expense {
  id: string;              // UUID v4
  date: string;            // ISO 8601形式 "2026-02-15T10:30:00+09:00"
  amount: number;          // 金額（円）
  location: string;        // 場所（コンビニ, タクシー等）
  category: ExpenseCategory; // カテゴリ
  memo: string;            // メモ
  createdAt: string;       // 記録日時
  updatedAt: string;       // 更新日時
}

type ExpenseCategory = 
  | '食費'
  | '交通費'
  | '事務用品費'
  | '通信費'
  | '研修費'
  | 'その他';
```

### 7.2 LocalStorage構造

```json
{
  "expenses": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "date": "2026-02-15T10:30:00+09:00",
      "amount": 450,
      "location": "コンビニ",
      "category": "食費",
      "memo": "昼食",
      "createdAt": "2026-02-15T10:30:00+09:00",
      "updatedAt": "2026-02-15T10:30:00+09:00"
    }
  ]
}
```

## 8. 成功指標（KPI）

### 8.1 MVP検証指標
- **記録継続率:** 30日後も週1回以上記録しているユーザー比率 > 30%
- **平均記録時間:** 一言入力→記録完了まで < 3秒
- **音声入力利用率:** 全記録のうち音声入力の割合 > 20%

### 8.2 プロダクト成長指標（公開後）
- **月間アクティブユーザー:** 100人（3ヶ月後）
- **記録数:** 累計10,000件（3ヶ月後）
- **エクスポート実行率:** 月1回以上エクスポートするユーザー > 50%

## 9. リリース計画

### Phase 1: MVP基本機能（Week 1）
- プロジェクトセットアップ
- 一言入力パーサー実装
- LocalStorage CRUD実装
- 入力フォーム + 一覧表示
- カテゴリ自動推定
- 音声入力対応

### Phase 2: サマリー・エクスポート（Week 2）
- 月次サマリー表示
- CSVエクスポート
- PDFエクスポート
- UI/UX改善

### Phase 3: PWA化（Week 3）
- Service Worker実装
- manifest.json設定
- オフライン対応
- ホーム画面追加テスト

### Phase 4: デプロイ・公開（Week 4）
- Cloudflare Pages設定
- 本番環境公開
- 百式DB更新（ステータス→公開済）

## 10. 将来の拡張案（MVP後）

- **クラウド同期:** Firebase/Supabaseで複数端末同期
- **領収書撮影:** OCRで金額・日付自動抽出
- **定期経費登録:** 毎月の固定費を自動記録
- **予算設定:** カテゴリ別予算超過アラート
- **会計ソフト連携:** freee/MFクラウドAPI直接連携
- **AI強化:** GPT-4でカテゴリ推定精度向上

---

**作成日:** 2026-02-15
**バージョン:** 1.0
**承認者:** imudak（自動承認）
